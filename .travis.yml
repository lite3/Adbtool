language: android
sudo: required

env:
  - PYVER=3.6.0
  - PYVER=3.7.2

matrix:
  allow_failures:
    - env: PYVER=3.7.2

android:
  components:
    # Uncomment the lines below if you want to
    # use the latest revision of Android SDK Tools
    # - platform-tools
    # - tools

    # The BuildTools version used by your project
    # - build-tools-19.1.0

    # The SDK version used to compile your project
    - android-22

    # Additional components
    # - extra-google-google_play_services
    # - extra-google-m2repository
    # - extra-android-m2repository
    # - addon-google_apis-google-19

    # Specify at least one system image,
    # if you need to run emulator(s) during your tests
    - sys-img-armeabi-v7a-android-22
    # - sys-img-armeabi-v7a-android-17
install:
  - cd ../
  - wget https://www.python.org/ftp/python/$PYVER/Python-$PYVER.tgz
  - tar -xvf Python-$PYVER.tgz
  - cd Python-$PYVER
  - ./configure --prefix=/usr/local/python-$PYVER>log1.log && make>log2.log && sudo make install>log3.log
  - python --version
  - echo "ls -lha /usr/bin"
  - ls -lha /usr/bin
  - echo "ls -lha /usr/local"
  - ls -lha /usr/local
  - sudo rm -f /usr/bin/python
  - ls -lha /usr/local/python-$PYVER/bin
  - pyshortver=`echo $PYVER|awk -F. '{printf "%d.%d\n", $1,$2}'`
  - echo "sudo ln -fs /usr/local/python-$PYVER/bin/python$pyshortver /usr/bin/python"
  - sudo ln -fs /usr/local/python-$PYVER/bin/python$pyshortver /usr/bin/python
  - sudo chmod +x /usr/bin/python
  - cd $TRAVIS_BUILD_DIR
  - sudo python -m pip install -r requirements.txt

before_script:
# Emulator Management: Create, Start and Wait
  - python --version
  - echo no | android create avd --force -n test -t android-22 --abi armeabi-v7a
  - emulator -avd test -no-audio -no-window &
  - android-wait-for-emulator
  # - adb shell input keyevent 82 &

  # - cd $TRAVIS_BUILD_DIR/$TRAVIS_REPO_SLUG
  # /home/travis/build/lite3/adbtool/lite3/adbtool
script:
  - cd $TRAVIS_BUILD_DIR
  - chmod +x -R .
  - ls -lha /usr/local/android-sdk/platform-tools
  - python adbtool/adbdevice.py -l
  - python adbtool/adbdevice.py -h
  - python adbtool/adbdevice.py -d 1 2
  - python adbtool/adbdevice.py -d em
  - python adbtool/adbpush.py -h
  - python adbtool/apkinstall.py -h
  - python adbtool/apkinstall.py test/adbtooltest.apk
